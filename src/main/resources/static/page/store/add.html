<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能排班系统</title>
    <link rel="stylesheet" href="../../plugins/element-ui/index.css">
    <link rel="stylesheet" href="../../styles/common.css">
    <link rel="stylesheet" href="../../styles/page.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.2.3/axios.js"></script>
</head>
<body>
    <div class="addBrand-container" id="store-add-app">
        <div class="container">
            <el-form
                ref="ruleForm"
                :model="ruleForm"
                :rules="rules"
                :inline="false"
                label-width="180px"
                class="demo-ruleForm"
            >
                <div>
                    <el-form-item
                        label="门店名称："
                        prop="name"
                    >
                        <el-input 
                            v-model="ruleForm.name"
                            placeholder="请输入门店名称"
                            maxlength="20"
                        />
                    </el-form-item>

                    <el-form-item
                        label="地址："
                        prop="address"
                    >
                        <el-input 
                            v-model="ruleForm.address"
                            placeholder="请输入地址"
                            maxlength="20"
                        />
                    </el-form-item>

                    <el-form-item
                        label="占地面积："
                        prop="size"
                    >
                        <el-input 
                            v-model="ruleForm.size"
                            placeholder="请输入占地面积"
                            maxlength="20"
                        />
                    </el-form-item>
                    
                </div>
                <div class="subBox prefer">
                    <el-form-item>
                        <el-button @click="goBack()">
                            取消
                        </el-button>
                        <el-button
                            type="primary"
                            @click="submitForm('ruleForm')"
                        >
                            保存
                        </el-button>
                        <el-button
                            v-if="actionType == 'add'"
                            type="primary"
                            class="continue"
                            @click="submitForm('ruleForm','goAnd')"
                        >
                            保存并继续添加门店
                        </el-button>
                    </el-form-item>
                </div>
            </el-form>
        </div>
    </div>
    <script src="../../plugins/vue/vue.js"></script>
    <script src="../../plugins/element-ui/index.js"></script>
    <script src="../../plugins/axios/axios.min.js"></script>
    <script src="../../js/request.js"></script>
    <script src="../../js/validate.js"></script>
    <script src="../../js/index.js"></script>
    <script src="../../api/store.js"></script>
</body>
    <script>
        new Vue({
            el:'#store-add-app',
            data(){
                return{
                    id:'',
                    restKey:0,
                    textarea:'',
                    value:'',
                    actionType:'',
                    vueRest:'1',
                    storeList:[],
                    index:0,
                    inputStyle:{'flex':1},
                    ruleForm:{
                        'name':'',
                        'address':'',
                        'size':'',
                    },
                    mak:false
                }
            },
            computed:{
                rules(){
                    return{
                        'name':[
                            {'required':true,'message':'请填写门店名称','trigger':'blur'}
                        ],
                        'address':[
                            {'required':true,'message':'请填写门店地址','trigger':'change'}
                        ],
                        'size':[
                            {'required':true,'message':'请填写门店占地面积','trigger':'blur'}
                        ],
                    }
                }
            },
            created(){
                this.id=requestUrlParam('id')
                this.actionType=this.id ? 'edit' : 'add'
                if(this.id){
                    this.init();
                }
            },
            mounted(){},
            methods: {
                async init(){
                    queryStoreById(this.id).then(res => {
                        console.log(res)
                        if(String(res.code) === '1'){
                            this.ruleForm = {...res.data}
                        }else{
                            this.$message.error(res.msg || '操作失败')
                        }
                    })
                },

                inputHandle(val,index){},
                submitForm(formName,st){
                    this.$refs[formName].validate((valid)=>{
                        if(valid){
                            let params = {...this.ruleForm}
                            params.storeId=this.ruleForm.storeId
                            if(this.actionType == 'add'){
                                delete params.id
                                addStore(params).then(res=>{
                                    if(res.code === 1){
                                        this.$message.success('门店添加成功！')
                                        if(!st){
                                            this.goBack()
                                        }else{
                                            this.ruleForm={
                                                'name':'',
                                                'address':'',
                                                'size':'',
                                            }
                                        }
                                    }else{
                                        this.$message.error(res.msg || '操作失败')
                                    }
                                }).catch(err=>{
                                    this.$message.error('请求出错了：'+err)
                                })
                            }else{
                                delete params.updateTime
                                editStore(params).then(res=>{
                                    if(res.code == 1){
                                        this.$message.success('门店信息修改成功！')
                                        this.goBack()
                                    }else{
                                        this.$message.error(res.msg || '操作失败')
                                    }
                                }).catch(err=>{
                                    this.$message.error('请求出错了：'+err)
                                })
                            }
                        }else{
                            return false
                        }
                    })
                },
                handleAvatarSuccess (response, file, fileList) {
                    // 拼接down接口预览
                    if(response.code === 0 && response.msg === '未登录'){
                      window.top.location.href = '../../page/login.html'
                    }else{
                    //   this.imageUrl = `/common/download?name=${response.data}`
                       this.ruleForm.image = response.data
                    }
                },
                goBack(){
                    window.parent.menuHandle({
                        id:'3',
                        url:'../../page/store/list.html',
                        name:'门店管理'
                    },false)
                }
            },
        });
    </script>
</html>